# Ping

Ping application based on SpringBoot.

The project consists of the following modules:
- web: contains the application with following endpoints
  - /ping
  - /hello
  - /actuator/health
- docker: builds a docker image containing this application
- contract-test: performs a contract test using spring-cloud-contract.
  It performs the following steps:
  1. start docker container
  2. perform integration test (generated by spring-cloud-contract)
  3. stop the docker container

## Build (including contract test)

To build the application you should have installed:
- JDK 11
- Maven 3.6.3
- Docker

You can build and run the contract test with:
```
mvn clean install
```

## Issue: Contract test fails when using newest version of spring-cloud-contract

The test succeeds when using spring-cloud-contract version 2.1.3.RELEASE.

It fails when using spring-cloud-contract version 2.2.2.RELEASE. You can try this with:
```
 mvn clean install -P use222
```
Remark: When the test fails the docker container is still running. You have to stop and remove it manually with
```
docker stop ping-1
docker rm ping-1
```
I did not find a way to fix that.

### 2.1.3.RELEASE
The problem lies in the generated source code in `contract-test/target/generated-test-sources/contracts/de/conciso/ping/ContractVerifierIT.java`

With 2.1.3 it generates a line
```
.method("POST", entity("{\"value\":\"test\"}", "application/my-content-type+json"));
```
Here the Content-Typ is correct as specified in the contract `howAreYou.groovy`.

### 2.2.2.RELEASE
When using 2.2.2 the line now is
```
.build("POST", entity("{\"value\":\"test\"}", "application/json"))
```
This fails because the Content-Type is wrong.

As far as I can see this happens when using the `+json` suffix (as specified in https://tools.ietf.org/html/rfc6839).
